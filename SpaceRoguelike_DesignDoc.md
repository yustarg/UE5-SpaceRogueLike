# 太空 Roguelike 游戏设计文档

## 1. 游戏概述

### 1.1 核心概念
- **类型**: 太空射击 + Roguelike
- **视角**: 第三人称俯视角（Top-Down）
- **核心玩法**: 操控飞船在随机生成的太空关卡中战斗，击败海量敌人
- **特色**: 永久死亡、随机地图、装备成长、弹幕射击

### 1.2 游戏目标
玩家操控一艘太空飞船，在无限延展的太空区域中尽可能长时间生存。随着时间推移，敌人数量、强度和种类不断增加，玩家需要通过击败敌人获得经验升级，收集装备强化自身，挑战生存极限。

---

## 2. 核心玩法机制

### 2.1 飞船操控
- **移动**: WASD 或方向键控制飞船移动
- **射击**: 鼠标左键/空格键射击，支持多种武器类型
- **技能**: 鼠标右键/Q/E 释放特殊技能
- **闪避**: Shift 短距离快速位移（冷却时间）
- **朝向**: 鼠标指向方向或移动方向

### 2.2 战斗系统
- **武器系统**:
  - 主武器（无限弹药，可升级）
  - 副武器（消耗能量/弹药，伤害高）
  - 武器类型: 激光、导弹、等离子炮、电磁脉冲等
  
- **技能系统**:
  - 护盾（短时间无敌）
  - 时间减速
  - 范围伤害技能
  - 召唤无人机/炮台
  
- **敌人类型**:
  - **小型敌人**: 快速移动，低血量，数量多（主要威胁来自数量）
  - **中型敌人**: 射击弹幕，中等血量（需要走位应对）
  - **重型敌人**: 慢速，高血量，强火力（威胁单体高伤）
  - **精英敌人**: 特殊能力，掉落稀有物品（随机出现的小BOSS）
  - **时限BOSS**: 每隔固定时间（如 5/10/15 分钟）出现的强力BOSS，击败后获得大量奖励

### 2.3 难度递增系统
游戏难度随生存时间增长，确保持续挑战性：

- **敌人生成频率递增**:
  - 基础生成率每分钟提升 5-10%
  - 0-5 分钟: 少量小型敌人
  - 5-10 分钟: 引入中型敌人，数量增加
  - 10-15 分钟: 重型敌人开始出现
  - 15+ 分钟: 多种敌人混合，密度极高
  
- **敌人强度提升**:
  - 血量随时间缓慢增长（每分钟 +5%）
  - 伤害值逐渐提升（每分钟 +3%）
  - 移动速度和射速提升（更难躲避）
  
- **精英与BOSS机制**:
  - 精英敌人出现概率随时间增加
  - 时限BOSS（5 分钟、10 分钟、15 分钟...）
  - BOSS 出现时全屏警告，给予玩家准备时间
  - 击败BOSS获得强力装备或永久增益
  
- **敌人种类解锁**:
  - 新的敌人变种在特定时间点解锁
  - 例: 10分钟后出现"狂暴型"变种（速度翻倍）
  - 15分钟后出现"装甲型"变种（防御极高）

### 2.4 游戏循环
单局游戏的核心循环：

1. **开始**: 选择飞船和初始装备
2. **战斗**: 击败敌人获得经验和掉落物
3. **升级**: 达到经验值后选择升级选项
4. **探索**: 寻找特殊地点（商人、补给等）
5. **应对递增**: 面对越来越强的敌人
6. **BOSS挑战**: 每 5 分钟对抗时限 BOSS
7. **死亡**: 生命值归零，结算奖励
8. **元进度**: 使用结晶进行永久升级

多局游戏的长期循环：
- 解锁新飞船和装备
- 尝试不同流派构建
- 挑战更长生存时间
- 完成成就和挑战

### 2.5 游戏结束与结算
**死亡条件**:
- 生命值归零
- 可选: 提供一次复活机会（消耗特殊道具或货币）

**结算界面**:
- 生存时间（主要指标）
- 击败敌人总数
- 击败的 BOSS 数量
- 最终等级
- 获得的装备数量
- 造成的总伤害
- 获得的元素结晶数量
- 新解锁的成就
- 历史最佳记录对比

**奖励计算**:
```
元素结晶 = 基础奖励 + (生存时间 × 10) + (击杀数 × 0.1) + (BOSS数 × 100)
```

### 2.6 Roguelike 元素
- **永久死亡**: 死亡后重新开始，记录最长生存时间和击杀数
- **随机生成**: 地图布局、敌人配置、物品掉落都随机
- **成长系统**: 
  - 局内成长（该局有效，升级和装备）
  - 永久升级（元进度，使用结晶解锁永久增益）
- **选择与取舍**: 每次升级提供多个选项，构建不同流派
- **生存目标**: 挑战生存更长时间，解锁成就和新内容
- **排行榜**: 记录最长生存时间、最高击杀数、单局最高伤害等
- **每日挑战**: 固定种子和修改器的特殊挑战

---

## 3. 地图系统

### 3.1 无限地图设计
- **地图类型**: 单一无缝大地图，无边界或循环边界
- **地图特点**:
  - 玩家可以自由移动，没有房间限制
  - 地图足够大或采用边缘循环机制
  - 视野外的区域动态加载/卸载
  
- **地图生成策略**:
  - **方案 A - 固定大地图**: 预设一个足够大的地图（如 10000x10000 单位）
  - **方案 B - 无限循环**: 到达边缘时从对侧重新出现（类似贪吃蛇）
  - **方案 C - 程序生成**: 分块（Chunk）动态生成，玩家移动时加载新区域

### 3.2 地图区域与生物群系
为增加视觉多样性，地图可划分不同生物群系：
- **小行星带**: 密集的小行星障碍物
- **星云区域**: 视觉效果华丽，可能有特殊效果（减速/加速）
- **废弃舰队**: 大型飞船残骸作为掩体
- **空旷星域**: 少障碍物，利于机动
- **危险区域**: 高风险高回报区域（更多敌人，更好掉落）

### 3.3 环境要素
- **静态障碍物**: 
  - 小行星（可被摧毁，可能掉落资源）
  - 废弃空间站碎片（作为掩体）
  - 能量立场（伤害接触者）
  - 空间碎片（视觉装饰）
  
- **动态地形效果**:
  - 陨石雨（随机位置掉落陨石）
  - 能量风暴（周期性出现，改变弹道）
  - 辐射云（缓慢移动的伤害区域）
  - 补给箱投放（随机位置刷新，提供临时增益）

### 3.4 敌人生成机制
在无限地图中，敌人生成需要特殊处理：

**生成位置策略**:
- **屏幕外生成**: 在玩家视野外一定距离生成（避免突兀）
- **多方向生成**: 从玩家周围多个方向生成，避免单一方向
- **距离限制**: 距离玩家 500-1000 单位的范围内生成
- **清理机制**: 距离玩家过远（2000+ 单位）的敌人自动清理

**生成模式**:
- **持续生成**: 每隔固定时间生成一波敌人
- **散点生成**: 敌人分散生成，不集中
- **编队生成**: 特定敌人以小队形式生成
- **精英预警**: 精英敌人生成时给予视觉/音效提示

### 3.5 特殊地点（可选）
虽然是无限地图，但可以生成稀有的特殊地点供玩家探索：
- **神秘商人**: 随机出现，提供装备交易
- **治疗信标**: 恢复生命值的安全区
- **武器工作台**: 升级现有装备
- **传送门**: 传送到地图其他位置或特殊挑战区
- **空间异常**: 高风险高回报的特殊事件区域
- **经验水晶**: 提供大量经验值

---

## 4. 成长与装备系统

### 4.1 局内成长
- **经验升级**: 击败敌人获得经验，升级时从3个随机选项中选择1个
  - 升级选项示例:
    - 增加火力 +20%
    - 最大生命值 +30
    - 射速 +15%
    - 暴击率 +10%
    - 获得新技能
    
- **装备拾取**:
  - **武器模组**: 改变武器射击方式
  - **被动道具**: 提供永久增益
  - **主动道具**: 可使用的消耗品或技能

### 4.2 装备品质
- **普通（白）**: 基础属性
- **稀有（蓝）**: 1-2个额外属性
- **史诗（紫）**: 2-3个强力属性
- **传说（橙）**: 独特效果，改变玩法

### 4.3 元进度系统
- **永久货币**: 死亡后保留的"元素结晶"（根据生存时间和击杀数获得）
- **飞船解锁**: 达到特定生存时间或完成挑战解锁新飞船
  - 示例: 生存 10 分钟解锁"突击型飞船"
  - 示例: 击败首个 BOSS 解锁"重装型飞船"
- **永久升级**:
  - 基础属性提升（生命值、移速、伤害等）
  - 初始装备解锁（每局开始自带特定装备）
  - 新技能解锁（扩展技能池）
  - 经验获取加成（更快升级）
- **成就系统**: 完成挑战获得奖励
  - 生存时间里程碑（5/10/15/20/30 分钟）
  - 击杀数里程碑（1000/5000/10000 敌人）
  - 特殊挑战（不使用某类装备通关、无伤击败BOSS等）

---

## 5. 技术架构设计（Unreal Engine）

### 5.1 核心系统类结构

#### 飞船系统
- `ASpaceShip` (Character类)
  - 飞船控制器
  - 武器管理组件
  - 生命值组件
  - 技能管理组件

#### 武器系统
- `UWeaponComponent` (ActorComponent)
  - 武器数据资产
  - 射击逻辑
  - 弹药管理
  
- `AProjectile` (Actor)
  - 子弹/导弹基类
  - 碰撞检测
  - 特效管理

#### 敌人系统
- `AEnemyBase` (Character类)
  - AI行为树
  - 攻击模式
  - 掉落物管理
  - 属性缩放（根据时间）
  
- `UEnemySpawner` (ActorComponent)
  - 敌人生成逻辑
  - 生成位置计算（屏幕外生成）
  - 生成频率管理（随时间递增）
  - 敌人类型选择（根据时间解锁）
  - 同屏数量限制

#### 地图生成系统
- `AProceduralMapGenerator` (Actor)
  - 地图块（Chunk）生成和管理
  - 障碍物分布算法
  - 生物群系配置
  - 地图边界处理（循环或限制）
  
- `AMapChunk` (Actor)
  - 地图块基类（分块加载优化）
  - 障碍物布局
  - 环境特效管理
  
- `ADifficultyManager` (Actor)
  - 难度曲线管理
  - 敌人生成频率控制
  - 时限BOSS触发系统

#### 装备与成长系统
- `UItemDataAsset` (DataAsset)
  - 装备数据定义
  
- `UProgressionManager` (GameInstanceSubsystem)
  - 经验管理
  - 升级选项生成
  - 元进度保存

### 5.2 数据管理
- **Data Tables**: 敌人配置、武器属性、房间模板
- **Data Assets**: 装备定义、技能定义
- **Save Game**: 元进度、成就、解锁内容

### 5.3 性能优化
- **对象池**: 子弹、敌人、粒子特效（避免频繁创建销毁）
- **LOD系统**: 远距离敌人简化渲染和AI
- **可见性剔除**: 只渲染视野范围内的对象
- **敌人限制**: 同时存在的敌人数量上限（根据性能动态调整）
- **分块加载**: 地图分块（Chunk）动态加载和卸载
- **距离剔除**: 超出一定距离的敌人自动清理
- **AI更新频率**: 远距离敌人降低AI更新频率

---

## 6. 美术风格与视觉设计

### 6.1 视觉风格
- **风格**: 赛博朋克太空 + 霓虹色彩
- **色调**: 深蓝、紫色太空背景 + 明亮的霓虹效果
- **特效**: 发光轨迹、能量护盾、爆炸粒子

### 6.2 UI/UX设计
- **HUD元素**:
  - 生命值条（左上角）
  - 护盾值
  - 当前武器/弹药
  - 技能冷却显示
  - **生存时间计时器**（顶部中央，醒目显示）
  - **下一个 BOSS 倒计时**（提醒玩家准备）
  - 当前等级和经验条
  - 击杀计数器
  - 小地图/雷达（右上角，显示敌人方位）
  
- **菜单**:
  - 升级选择界面（暂停游戏，3选1）
  - 背包/装备界面
  - 暂停菜单（可查看当前属性和统计）
  
- **特殊提示**:
  - BOSS 即将出现警告（全屏红色闪烁）
  - 新敌人类型解锁提示
  - 达成里程碑通知（每 5 分钟）

### 6.3 特效需求
- 飞船引擎尾焰
- 武器射击轨迹
- 命中反馈（粒子+震屏）
- 护盾冲击波
- 敌人死亡爆炸

---

## 7. 音效设计

### 7.1 音效列表
- **武器音效**: 不同武器的射击声
- **爆炸音效**: 小、中、大型爆炸
- **环境音效**: 太空环境音、警报声
- **UI音效**: 按钮点击、升级提示
- **敌人音效**: 敌人攻击、死亡

### 7.2 音乐
- **背景音乐**: 电子合成器风格，紧张刺激
- **Boss战音乐**: 更激烈的战斗音乐
- **菜单音乐**: 平静的太空主题

---

## 8. 开发路线图

### 阶段 1: 核心原型（MVP）
- [ ] 基础飞船控制（移动、射击）
- [ ] 简单敌人AI（追踪、射击）
- [ ] 基础碰撞和伤害系统
- [ ] 单个测试场景

### 阶段 2: 战斗系统
- [ ] 多种武器类型
- [ ] 技能系统框架
- [ ] 3-5种敌人类型
- [ ] 敌人生成系统（波次/持续生成）
- [ ] 基础UI（生命值、技能、生存时间）

### 阶段 3: 地图系统
- [ ] 无限地图或大地图实现
- [ ] 障碍物生成和分布
- [ ] 不同生物群系视觉效果
- [ ] 地图边界处理（循环或限制）
- [ ] 动态地形效果（陨石雨等）

### 阶段 4: 难度递增系统
- [ ] 时间追踪系统
- [ ] 敌人生成频率递增
- [ ] 敌人属性随时间提升
- [ ] 时限BOSS系统（5/10/15 分钟触发）
- [ ] 精英敌人机制

### 阶段 5: 成长系统
- [ ] 经验和升级
- [ ] 装备系统（拾取和装备）
- [ ] 物品掉落系统
- [ ] 升级选项生成

### 阶段 6: Roguelike 机制
- [ ] 永久死亡和重置
- [ ] 元进度系统（结晶收集）
- [ ] 永久升级商店
- [ ] 飞船解锁系统
- [ ] 随机性平衡调整

### 阶段 7: 视觉与音效
- [ ] 粒子特效（射击、爆炸、引擎）
- [ ] 音效集成
- [ ] UI美化和动画
- [ ] 后处理效果
- [ ] 不同生物群系视觉表现

### 阶段 8: 内容扩展
- [ ] 更多敌人变种（10+ 种）
- [ ] 更多武器和装备（30+ 种）
- [ ] 更多飞船类型（5+ 种）
- [ ] 成就系统实现
- [ ] 特殊地点和事件

### 阶段 9: 优化与测试
- [ ] 性能优化（对象池、LOD）
- [ ] 平衡性调整（难度曲线测试）
- [ ] 长时间生存测试（30+ 分钟）
- [ ] Bug修复
- [ ] 完整测试

---

## 9. 难度曲线设计细节

### 9.1 敌人生成曲线
建议使用指数增长配合上限限制，避免性能问题：

**生成频率公式**:
```
SpawnRate = BaseRate × (1 + Time × 0.1) × Multiplier
MaxEnemies = 50 + (Time / 2)  // 每 2 分钟增加 1 个上限
```

**时间节点示例**:
- **0-2 分钟**: 新手期，敌人稀疏，让玩家熟悉操作
- **2-5 分钟**: 敌人数量稳步增长，开始有压力
- **5-10 分钟**: 引入新敌人类型，首个 BOSS 出现
- **10-15 分钟**: 敌人混合编队，密度较高
- **15-20 分钟**: 精英敌人频繁出现，第三个 BOSS
- **20+ 分钟**: 极限挑战，多种强敌同时出现

### 9.2 敌人属性缩放
**属性增长公式**:
```
Health = BaseHealth × (1 + Time × 0.05)      // 每分钟 +5%
Damage = BaseDamage × (1 + Time × 0.03)      // 每分钟 +3%
Speed = BaseSpeed × (1 + Time × 0.02)        // 每分钟 +2%，上限 150%
```

**平衡要点**:
- 玩家升级速度要略快于敌人强度增长
- 10 分钟左右出现难度墙，需要玩家有良好的流派构建
- 20 分钟后主要考验玩家的走位和操作

### 9.3 BOSS 时间表
- **5 分钟**: 第一个 BOSS（简单，教学性质）
- **10 分钟**: 第二个 BOSS（中等难度，多阶段）
- **15 分钟**: 第三个 BOSS（较难，复杂攻击模式）
- **20 分钟**: 第四个 BOSS（极难）
- **之后**: 每 5 分钟一个 BOSS，随机从池中选择

### 9.4 奖励曲线
确保玩家能够跟上难度增长：
- **经验获取**: 击败敌人的经验随其强度增长
- **掉落品质**: 时间越长，高品质装备掉落概率越高
- **BOSS 奖励**: 必定掉落稀有/史诗装备
- **里程碑奖励**: 每 5 分钟生存给予额外奖励

---

## 10. 参考游戏

### 核心玩法参考
- **Vampire Survivors**: 海量敌人 + 自动射击 + 升级选择 + **时间递增难度**（重点参考）
- **Brotato**: 波次生存 + 商店升级 + 多样化流派构建
- **20 Minutes Till Dawn**: 限时生存 + 弹幕射击
- **Risk of Rain 2**: 随机生成 + 装备组合 + **时间难度递增**
- **Enter the Gungeon**: Roguelike + 弹幕射击 + 流畅手感
- **Hades**: 优秀的战斗手感和成长系统
- **Asteroids**: 经典太空射击操控感

### 视觉风格参考
- **Geometry Wars**: 霓虹太空射击 + 简洁明快
- **Returnal**: 太空科幻氛围 + 粒子特效
- **Nova Drift**: 简洁的太空射击视觉 + 流派构建
- **Everspace**: 太空环境和视觉效果

---

## 11. 技术要求与注意事项

### 11.1 性能目标
- **帧率**: 60 FPS（PC）
- **同屏敌人**: 50-100个（后期可能更多）
- **子弹数量**: 200-500个（对象池复用）
- **长时间运行**: 确保 30+ 分钟游戏不卡顿、不内存泄漏

### 11.2 开发注意事项
- 从小规模开始，确保核心循环有趣
- **难度曲线是关键**: 需要大量测试和调整
- 先实现基础功能，再添加复杂特性
- 持续测试平衡性，避免数值膨胀
- 使用版本控制管理资产
- 定期性能测试，尤其是长时间运行
- 记录玩家数据（生存时间分布），用于平衡调整

### 11.3 可扩展性
- 使用数据驱动设计，便于添加新内容
- 模块化系统，便于替换和升级
- 保留接口供后续功能扩展
- 难度参数可配置，方便快速调整

---

## 12. 风险与挑战

### 12.1 技术风险
- **性能问题**: 大量实体可能导致性能下降，尤其是长时间游戏后
  - 解决方案: 对象池、LOD、限制数量、定期清理远距离敌人
  
- **内存泄漏**: 长时间运行可能导致内存泄漏
  - 解决方案: 严格的对象生命周期管理，定期 Profile
  
- **无限地图**: 边界处理和性能优化需要特别注意
  - 解决方案: 采用循环地图或分块加载

### 12.2 设计风险
- **难度曲线**: 最大挑战，太简单或太难都会破坏体验
  - 解决方案: 大量测试，收集数据，迭代调整
  
- **平衡性**: 装备组合可能过强或过弱，导致难度失衡
  - 解决方案: 数值可配置，快速迭代测试
  
- **重复性**: 无限生存容易变得重复和单调
  - 解决方案: 丰富的流派构建、随机事件、特殊地点、多样敌人

### 12.3 开发风险
- **范围蔓延**: 功能过多导致开发周期过长
  - 解决方案: 严格按照路线图执行，MVP优先
  
- **难度调试时间**: 平衡难度曲线需要大量时间
  - 解决方案: 预留充足的调试和测试时间

---

## 13. 总结

这个太空 Roguelike 游戏采用**无限生存模式**，结合了快节奏的射击玩法和深度的成长系统。玩家的目标是尽可能长时间生存，随着时间推移面对越来越强的敌人。开发重点应该放在：

1. **核心手感**: 飞船控制必须流畅爽快
2. **反馈系统**: 打击感、视觉反馈要到位
3. **难度曲线**: 确保难度递增合理，既有挑战性又不会过早绝望
4. **成长曲线**: 让玩家的成长能够匹配难度增长
5. **节奏把控**: 通过时限 BOSS 和特殊事件创造高潮与低谷

### 核心设计理念
- **一局一命**: 每次游戏都是完整体验，专注于单局乐趣
- **时间压力**: 难度持续提升，制造紧张感
- **成长快感**: 频繁升级和装备获取，不断变强
- **多样性**: 通过随机性和流派构建提供重玩价值
- **挑战性**: 为硬核玩家提供长时间生存的挑战目标

建议采用迭代开发方式，先完成最小可玩原型，验证核心玩法是否有趣（尤其是难度曲线是否合理），再逐步添加内容和系统。

---

## 14. 快速开始指南

### 第一周目标（核心原型）
1. **创建基础飞船**:
   - 实现 WASD 移动
   - 鼠标瞄准和射击
   - 简单的子弹对象池

2. **创建测试敌人**:
   - 单一类型的追踪敌人
   - 简单的生成系统（固定频率）
   - 基础碰撞和伤害

3. **核心UI**:
   - 生命值显示
   - 计时器
   - 击杀计数

4. **验证手感**:
   - 移动是否流畅？
   - 射击是否爽快？
   - 敌人数量是否合适？

### 关键里程碑
- **里程碑 1**: 能玩 5 分钟不觉得无聊
- **里程碑 2**: 难度曲线基本合理（10 分钟测试）
- **里程碑 3**: 有 3+ 种流派构建可选
- **里程碑 4**: 完整的一局体验（包括元进度）

### 常见陷阱
1. **不要过早优化**: 先验证玩法，再考虑性能
2. **不要忽视手感**: 控制和反馈是第一优先级
3. **不要低估平衡难度**: 预留大量时间调整数值
4. **不要功能蔓延**: 严格控制第一版范围

---

**文档版本**: 2.0  
**创建日期**: 2026-01-25  
**更新日期**: 2026-01-25  
**更新内容**: 修改为无限地图生存模式，难度随时间递增  
**下次更新**: 原型开发后根据测试结果更新
